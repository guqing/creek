(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-146b91b4"],{"432b":function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var r=a("5530"),n=a("5880"),o={computed:Object(r["a"])(Object(r["a"])({},Object(n["mapState"])({layout:function(e){return e.app.layout},navTheme:function(e){return e.app.theme},primaryColor:function(e){return e.app.color},colorWeak:function(e){return e.app.weak},fixedHeader:function(e){return e.app.fixedHeader},fixedSidebar:function(e){return e.app.fixedSidebar},contentWidth:function(e){return e.app.contentWidth},autoHideHeader:function(e){return e.app.autoHideHeader},isMobile:function(e){return e.app.isMobile},sideCollapsed:function(e){return e.app.sideCollapsed},multiTab:function(e){return e.app.multiTab}})),{},{isTopMenu:function(){return"topmenu"===this.layout}}),methods:{isSideMenu:function(){return!this.isTopMenu}}}},"98bb":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-card",{attrs:{bordered:!1}},[a("div",{staticClass:"table-operator"},[a("a-form",{attrs:{layout:"inline"}},[a("a-form-item",{attrs:{label:"角色名称"}},[a("a-input",{attrs:{placeholder:"角色名称"},model:{value:e.queryParam.roleName,callback:function(t){e.$set(e.queryParam,"roleName",t)},expression:"queryParam.roleName"}})],1),a("a-form-item",{attrs:{label:"角色描述"}},[a("a-input",{attrs:{placeholder:"角色描述"},model:{value:e.queryParam.remark,callback:function(t){e.$set(e.queryParam,"remark",t)},expression:"queryParam.remark"}})],1),a("a-form-item",[a("a-button",{attrs:{type:"primary",loading:e.loadingState.query},on:{click:e.handleSearch}},[e._v(" 查询 ")]),a("a-button",{staticStyle:{"margin-left":"8px"},attrs:{loading:e.loadingState.reset},on:{click:e.handleResetSearchForm}},[e._v(" 重置 ")])],1)],1)],1),a("div",{staticStyle:{"margin-bottom":"15px"}},[a("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:function(){return e.modalVisiable=!0}}},[e._v(" 新建 ")])],1),a("s-table",{ref:"table",attrs:{size:"default",rowKey:"id",columns:e.columns,data:e.loadData,showPagination:"auto",alert:!1},scopedSlots:e._u([{key:"action",fn:function(t,r){return a("span",{},[r.isInternal?a("div",[a("a",{attrs:{href:"javascript:;"},on:{click:function(){return e.$refs.detail.show(r)}}},[e._v(" 详情 ")])]):a("div",[a("a",{on:{click:function(t){return e.handleRoleEdit(r)}}},[e._v("编辑")]),a("a-divider",{attrs:{type:"vertical"}}),a("a-dropdown",[a("a",{staticClass:"ant-dropdown-link"},[e._v(" 更多 "),a("a-icon",{attrs:{type:"down"}})],1),a("a-menu",{attrs:{slot:"overlay"},slot:"overlay"},[a("a-menu-item",[a("a",{attrs:{href:"javascript:;"},on:{click:function(){return e.$refs.detail.show(r)}}},[e._v(" 详情 ")])]),a("a-menu-item",[a("a",{attrs:{href:"javascript:;"},on:{click:function(t){return e.deleteRole(r)}}},[e._v("删除")])])],1)],1)],1)])}}])}),a("RoleModal",{ref:"roleModal",attrs:{visible:e.modalVisiable},on:{cancel:function(){return e.modalVisiable=!1},ok:e.handleSaveOrUpdateRole}}),a("DetailModal",{ref:"detail"})],1)},n=[],o=a("2af9"),i=a("cc5e"),l=a("432b"),s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",e._l(e.resources,(function(t){return a("a-row",{key:t.name},[a("div",{style:{borderBottom:"1px solid #E9E9E9",borderTop:"1px solid #E9E9E9",padding:"8px 0"}},[a("a-checkbox",{on:{change:function(a){return e.onResourceCheckChange(a,t.name)}},model:{value:t.checked,callback:function(a){e.$set(t,"checked",a)},expression:"resource.checked"}},[a("a-space",{attrs:{size:"large"}},[e._v(" "+e._s(t.displayName)+" "),a("span",[e._v(e._s(t.description))])])],1)],1),a("br"),a("div",{staticStyle:{"padding-left":"21px"}},[a("a-list",{attrs:{"data-source":t.scopes},scopedSlots:e._u([{key:"renderItem",fn:function(r){return a("a-list-item",{},[a("a-checkbox",{on:{change:function(a){return e.onScopeCheckChange(a,t.name)}},model:{value:r.checked,callback:function(t){e.$set(r,"checked",t)},expression:"scope.checked"}},[e._v(" "+e._s(r.displayName)+" "),a("span",{staticStyle:{"margin-left":"15px"}},[e._v(e._s(r.description))])])],1)}}],null,!0)})],1),a("div",{staticStyle:{"margin-bottom":"15px"}})])})),1)},c=[],u=(a("d3b7"),a("159b"),a("5db7"),a("73d9"),a("d81d"),a("b0c0"),a("caad"),a("2532"),a("4de4"),a("b775")),d={list:function(e){return Object(u["b"])({url:"/resources/list-view",method:"get",params:e})}},m=d,p={name:"ApiScope",props:{defaultCheck:{type:Array,default:function(){return[]}}},data:function(){return{resources:[]}},mounted:function(){this.listResource()},methods:{listResource:function(){var e=this;m.list().then((function(t){e.resources=t.data,e.resources.map((function(t){var a=t.scopes.map((function(e){return e.name})).every((function(t){return e.defaultCheck.includes(t)}));return e.$set(t,"checked",a),t.scopes})).flatMap((function(e){return e})).forEach((function(t){var a=e.defaultCheck.includes(t.name);e.$set(t,"checked",a)}))}))},onScopeCheckChange:function(e,t){var a=this;this.resources.filter((function(e){return e.name===t})).forEach((function(e){var t=e.scopes.map((function(e){return e.checked||!1}));a.$set(e,"checked",!t.includes(!1))}))},onResourceCheckChange:function(e,t){var a=this;this.resources.filter((function(e){return e.name===t})).map((function(e){return e.scopes})).flatMap((function(e){return e})).forEach((function(t){a.$set(t,"checked",e.target.checked)}))},getAuthority:function(){return this.resources.map((function(e){return e.scopes})).flatMap((function(e){return e})).filter((function(e){return!0===e.checked}))},reset:function(){this.listResource()}}},f=p,h=a("2877"),b=Object(h["a"])(f,s,c,!1,null,null,null),v=b.exports,k=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-modal",{attrs:{title:"新增角色",visible:e.visible,"on-ok":"handleOk",destroyOnClose:""},on:{cancel:e.handleCancel}},[a("div",{staticClass:"steps-action"},[0==e.current?a("a-form-model",{ref:"roleForm",attrs:{model:e.roleForm,rules:e.rules}},[a("a-form-model-item",{attrs:{label:"角色名称",prop:"roleName"}},[a("a-input",{model:{value:e.roleForm.roleName,callback:function(t){e.$set(e.roleForm,"roleName",t)},expression:"roleForm.roleName"}})],1),a("a-form-model-item",{attrs:{label:"角色描述",prop:"remark"}},[a("a-textarea",{attrs:{placeholder:"角色描述最大长度不能超过150字符",maxLength:150,allowClear:"","auto-size":{minRows:3,maxRows:5}},model:{value:e.roleForm.remark,callback:function(t){e.$set(e.roleForm,"remark",t)},expression:"roleForm.remark"}})],1),a("a-form-model",[a("a-alert",{attrs:{type:"info",showIcon:""}},[a("p",{attrs:{slot:"description"},slot:"description"},[e._v(" 下一步"),a("br"),e._v(" 您需要进一步编辑角色的权限。 ")])])],1)],1):e._e(),1==e.current?a("api-scope",{ref:"apiScope",attrs:{defaultCheck:e.roleForm.authorities}}):e._e()],1),a("template",{slot:"footer"},[a("a-button",{key:"back",on:{click:e.handleCancel}},[e._v("取消")]),0==e.current?a("a-button",{key:"submit",attrs:{type:"primary"},on:{click:e.handleAuthority}},[e._v(" 编辑权限 ")]):e._e(),1==e.current?a("a-button",{key:"submit",attrs:{type:"primary"},on:{click:e.handleOk}},[e._v(" 确定 ")]):e._e()],1)],2)},y=[],g={name:"RoleModal",props:{visible:{type:Boolean,default:!1}},components:{ApiScope:v},data:function(){return{current:0,roleForm:{},rules:{roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"},{max:50,message:"字符长度不能超过 50",trigger:"blur"}],remark:[{max:150,message:"角色描述字符长度不能超过 150",trigger:"blur"}]}}},methods:{edit:function(e){var t=this;e.id&&(this.roleForm=e,i["a"].getById(e.id).then((function(e){t.roleForm["authorities"]=e.data.authorities})))},handleAuthority:function(){var e=this;this.$refs.roleForm.validate((function(t){if(!t)return!1;e.current++}))},handleOk:function(){var e=this.$refs.apiScope.getAuthority()||[];if(this.roleForm["authorities"]=e.map((function(e){return e.name})),0===e.length)return this.$message.error("请选择权限"),!1;this.$emit("ok",this.roleForm)},handleCancel:function(){this.reset(),this.$emit("cancel")},reset:function(){this.current=0,this.roleForm={}}}},S=g,_=Object(h["a"])(S,k,y,!1,null,null,null),x=_.exports,$=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-modal",{attrs:{title:"详情",destroyOnClose:""},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[a("api-scope",{ref:"apiScope",attrs:{defaultCheck:e.role.authorities}}),a("template",{slot:"footer"},[a("a-button",{attrs:{type:"primary"},on:{click:e.handleCancel}},[e._v("确定")])],1)],2)},C=[],O={name:"DetailModal",components:{ApiScope:v},data:function(){return{visible:!1,role:{}}},methods:{show:function(e){var t=this;this.visible=!0,i["a"].getById(e.id).then((function(e){t.role=e.data}))},handleCancel:function(){this.visible=!1,this.role={}}}},w=O,R=Object(h["a"])(w,$,C,!1,null,null,null),j=R.exports,F={name:"TreeList",mixins:[l["a"]],components:{STable:o["i"],ApiScope:v,RoleModal:x,DetailModal:j},data:function(){var e=this;return{loadingState:{save:!1,query:!1,reset:!1},modalVisiable:!1,queryParam:{},columns:[{title:"角色名称",dataIndex:"roleName",needTotal:!0},{title:"角色描述",dataIndex:"remark"},{title:"创建时间",dataIndex:"createTime",sorter:!0},{title:"操作",dataIndex:"action",width:"150px",scopedSlots:{customRender:"action"}}],loadData:function(t){var a=Object.assign({},e.queryParam);return a.current=t.pageNo,a.pageSize=t.pageSize,i["a"].listRole(a).then((function(e){return{pageSize:e.data.pageSize,pageNo:e.data.current,totalCount:e.data.total,totalPage:e.data.pages,data:e.data.list}})).catch((function(t){return e.$message.error("查询出错:".concat(t)),{pageSize:0,pageNo:1,totalCount:0,totalPage:0,data:[]}}))}}},methods:{handleRoleEdit:function(e){this.modalVisiable=!0,this.$refs.roleModal.edit(e)},handleClick:function(e){this.queryParam={key:e.key},this.$refs.table.refresh(!0)},handleSaveOrUpdateRole:function(e){var t=this;i["a"].createOrUpdate(e).then((function(){t.modalVisiable=!1,t.$message.success("保存成功"),t.$refs.table.refresh(),t.$refs.roleModal.reset()}))},handleSearch:function(){var e=this;this.loadingState.query=!0,this.$refs.table.refresh(),setTimeout((function(){e.loadingState.query=!1}),1500)},handleResetSearchForm:function(){var e=this;this.loadingState.reset=!0,this.queryParam={},this.$refs.table.refresh(),setTimeout((function(){e.loadingState.reset=!1}),1500)},deleteRole:function(e){var t=this;i["a"].deleteById(e.id).then((function(e){t.$message.success("删除成功"),t.$refs.table.refresh(!0)}))}}},M=F,q=Object(h["a"])(M,r,n,!1,null,null,null);t["default"]=q.exports},cc5e:function(e,t,a){"use strict";var r=a("b775"),n={listRole:function(e){return Object(r["b"])({url:"/role/list",method:"get",params:e})},getById:function(e){return Object(r["b"])({url:"/role/".concat(e),method:"get"})},createOrUpdate:function(e){return Object(r["b"])({url:"/role/save",method:"post",data:e})}};n.getById=function(e){return Object(r["b"])({url:"/role/".concat(e),method:"get"})},n.deleteById=function(e){return Object(r["b"])({url:"/role/".concat(e),method:"delete"})},n.options=function(){return Object(r["b"])({url:"/role/options",method:"get"})},t["a"]=n}}]);